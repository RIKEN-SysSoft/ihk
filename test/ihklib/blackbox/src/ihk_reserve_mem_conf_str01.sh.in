#!/usr/bin/bash

. @CMAKE_INSTALL_PREFIX@/bin/util.sh

# define WORKDIR
SCRIPT_PATH=$(readlink -m "${BASH_SOURCE[0]}")
AUTOTEST_HOME="${SCRIPT_PATH%/*/*/*}"
if [ -f ${AUTOTEST_HOME}/bin/config.sh ]; then
    . ${AUTOTEST_HOME}/bin/config.sh
else
    WORKDIR=$(pwd)
fi

memleak_pro

for i in {0..1}; do
    sudo @CMAKE_INSTALL_PREFIX@/bin/ihk_reserve_mem_conf_str01 -i $i || exit $?
    ret=$?

    if (( i == 1 )); then
	sudo @CMAKE_INSTALL_PREFIX@/bin/ihk_reserve_mem_conf_str01 -c || exit $?
    fi

    (( ret != 0 )) && exit $ret
done

memleak_epi

exit 0
